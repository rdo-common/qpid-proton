From ba8cee70089adfe64c2429a20eb5bee90d96b606 Mon Sep 17 00:00:00 2001
From: "Darryl L. Pierce" <mcpierce@gmail.com>
Date: Tue, 17 Mar 2015 09:04:31 -0400
Subject: [PATCH 2/2] PROTON-582: Added in missing is_float method to Perl
 bindings.

---
 examples/perl/messenger/send.pl                   | 2 +-
 proton-c/bindings/perl/lib/qpid/proton/Data.pm    | 4 ++--
 proton-c/bindings/perl/lib/qpid/proton/Message.pm | 2 +-
 proton-c/bindings/perl/lib/qpid/proton/utils.pm   | 7 +++++++
 4 files changed, 11 insertions(+), 4 deletions(-)

diff --git a/examples/perl/messenger/send.pl b/examples/perl/messenger/send.pl
index b622b68..27893ce 100755
--- a/examples/perl/messenger/send.pl
+++ b/examples/perl/messenger/send.pl
@@ -59,7 +59,7 @@ foreach (@messages)
 {
     $msg->set_address($address);
     $msg->set_subject($subject);
-    $msg->set_content($content);
+    $msg->set_body($content);
     # try a few different body types
     my $body_type = int(rand(6));
     $msg->set_property("sent", "" . localtime(time));
diff --git a/proton-c/bindings/perl/lib/qpid/proton/Data.pm b/proton-c/bindings/perl/lib/qpid/proton/Data.pm
index 156e09a..494a8f3 100644
--- a/proton-c/bindings/perl/lib/qpid/proton/Data.pm
+++ b/proton-c/bindings/perl/lib/qpid/proton/Data.pm
@@ -1165,8 +1165,8 @@ sub put_list_helper {
     $self->enter;
 
     for my $value (@{$array}) {
-        if (qpid::proton::is_num($value)) {
-            if (qpid::proton::is_float($value)) {
+        if (qpid::proton::utils::is_num($value)) {
+            if (qpid::proton::utils::is_float($value)) {
                 $self->put_float($value);
             } else {
                 $self->put_int($value);
diff --git a/proton-c/bindings/perl/lib/qpid/proton/Message.pm b/proton-c/bindings/perl/lib/qpid/proton/Message.pm
index b36caa7..0251b89 100644
--- a/proton-c/bindings/perl/lib/qpid/proton/Message.pm
+++ b/proton-c/bindings/perl/lib/qpid/proton/Message.pm
@@ -438,7 +438,7 @@ sub set_body {
     # be, which is going to be a best guess
     if (!defined($body_type)) {
         if (qpid::proton::utils::is_num($body)) {
-            if (qpid::proton::is_float($body)) {
+            if (qpid::proton::utils::is_float($body)) {
                 $body_type = qpid::proton::FLOAT;
             } else {
                 $body_type = qpid::proton::INT;
diff --git a/proton-c/bindings/perl/lib/qpid/proton/utils.pm b/proton-c/bindings/perl/lib/qpid/proton/utils.pm
index 5652535..0ab4e3e 100644
--- a/proton-c/bindings/perl/lib/qpid/proton/utils.pm
+++ b/proton-c/bindings/perl/lib/qpid/proton/utils.pm
@@ -28,4 +28,11 @@ sub is_num {
     $_[0] ^ $_[0] ? 0 : 1
 }
 
+sub is_float {
+    my $val = $_[0];
+
+    return 1 if ($val - int($val));
+    return 0;
+}
+
 1;
-- 
2.1.0

