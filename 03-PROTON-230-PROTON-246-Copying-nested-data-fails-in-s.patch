From 595eefb5154017ec151bb551cf973735488654d2 Mon Sep 17 00:00:00 2001
From: astitcher <astitcher@13f79535-47bb-0310-9956-ffa450edef68>
Date: Thu, 21 Feb 2013 17:33:55 +0000
Subject: [PATCH] PROTON-230, PROTON-246: Copying nested data fails in some
 cases

git-svn-id: https://svn.apache.org/repos/asf/qpid/proton/trunk@1448733 13f79535-47bb-0310-9956-ffa450edef68
---
 proton-c/src/codec/codec.c | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/proton-c/src/codec/codec.c b/proton-c/src/codec/codec.c
index ee646ab..843abab 100644
--- a/proton-c/src/codec/codec.c
+++ b/proton-c/src/codec/codec.c
@@ -2949,14 +2949,13 @@ int pn_data_appendn(pn_data_t *data, pn_data_t *src, int limit)
         pn_data_exit(data);
         pn_data_exit(src);
         level--;
+        continue;
       }
 
-      if (pn_data_next(src)) {
-        break;
-      } else {
+      if (!pn_data_next(src)) {
         stop = true;
-        break;
       }
+      break;
     }
 
     if (stop) break;
-- 
1.8.1.2

